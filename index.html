<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitcoin Supply Tracker - Farcaster Frame</title>
  
  <!-- Farcaster Frame Meta Tags -->
  <meta property="fc:frame" content="vNext" />
  <meta property="fc:frame:image" content="https://votre-app.vercel.app/og-image.png" />
  <meta property="fc:frame:image:aspect_ratio" content="1:1" />
  <meta property="fc:frame:button:1" content="üîÑ Actualiser" />
  <meta property="fc:frame:button:1:action" content="post" />
  <meta property="fc:frame:post_url" content="https://votre-app.vercel.app/api/frame" />
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Bitcoin Supply Tracker" />
  <meta property="og:description" content="Suivi en temps r√©el du nombre de Bitcoin en circulation" />
  <meta property="og:image" content="https://votre-app.vercel.app/og-image.png" />
  
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="module">
    import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
    import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
    
    const RefreshCw = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
    );

    function BitcoinSupplyTracker() {
      const [supply, setSupply] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [lastUpdate, setLastUpdate] = useState(null);

      const fetchBitcoinSupply = async () => {
        setLoading(true);
        setError(null);
        
        try {
          const response = await fetch('https://blockchain.info/q/totalbc');
          
          if (!response.ok) {
            throw new Error('Erreur lors de la r√©cup√©ration des donn√©es');
          }
          
          const data = await response.text();
          const btcSupply = parseInt(data) / 100000000;
          
          setSupply(btcSupply);
          setLastUpdate(new Date());
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        fetchBitcoinSupply();
        const interval = setInterval(fetchBitcoinSupply, 30000);
        return () => clearInterval(interval);
      }, []);

      const formatNumber = (num) => {
        return new Intl.NumberFormat('fr-FR', {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        }).format(num);
      };

      const maxSupply = 21000000;
      const percentageMined = supply ? ((supply / maxSupply) * 100).toFixed(4) : 0;

      return React.createElement('div', {
        className: "min-h-screen bg-gradient-to-br from-orange-500 via-amber-500 to-yellow-500 flex items-center justify-center p-4"
      },
        React.createElement('div', {
          className: "bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full"
        },
          React.createElement('div', { className: "text-center mb-8" },
            React.createElement('div', { className: "inline-block bg-gradient-to-r from-orange-500 to-amber-500 rounded-full p-4 mb-4" },
              React.createElement('svg', {
                className: "w-16 h-16 text-white",
                fill: "currentColor",
                viewBox: "0 0 24 24"
              },
                React.createElement('path', {
                  d: "M23.638 14.904c-1.602 6.43-8.113 10.34-14.542 8.736C2.67 22.05-1.244 15.525.362 9.105 1.962 2.67 8.475-1.243 14.9.358c6.43 1.605 10.342 8.115 8.738 14.548v-.002zm-6.35-4.613c.24-1.59-.974-2.45-2.64-3.03l.54-2.153-1.315-.33-.525 2.107c-.345-.087-.705-.167-1.064-.25l.526-2.127-1.32-.33-.54 2.165c-.285-.067-.565-.132-.84-.2l-1.815-.45-.35 1.407s.975.225.955.236c.535.136.63.486.615.766l-1.477 5.92c-.075.166-.24.406-.614.314.015.02-.96-.24-.96-.24l-.66 1.51 1.71.426.93.242-.54 2.19 1.32.327.54-2.17c.36.1.705.19 1.05.273l-.51 2.154 1.32.33.545-2.19c2.24.427 3.93.257 4.64-1.774.57-1.637-.03-2.58-1.217-3.196.854-.193 1.5-.76 1.68-1.93h.01zm-3.01 4.22c-.404 1.64-3.157.75-4.05.53l.72-2.9c.896.23 3.757.67 3.33 2.37zm.41-4.24c-.37 1.49-2.662.735-3.405.55l.654-2.64c.744.18 3.137.524 2.75 2.084v.006z"
                })
              )
            ),
            React.createElement('h1', { className: "text-3xl font-bold text-gray-800 mb-2" }, 'Bitcoin en Circulation'),
            React.createElement('p', { className: "text-gray-600" }, 'Suivi en temps r√©el')
          ),
          
          loading && !supply
            ? React.createElement('div', { className: "text-center py-8" },
                React.createElement(RefreshCw, { className: "w-8 h-8 text-orange-500 animate-spin mx-auto" }),
                React.createElement('p', { className: "text-gray-600 mt-4" }, 'Chargement...')
              )
            : error
            ? React.createElement('div', { className: "text-center py-8" },
                React.createElement('p', { className: "text-red-500 mb-4" }, error),
                React.createElement('button', {
                  onClick: fetchBitcoinSupply,
                  className: "px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors"
                }, 'R√©essayer')
              )
            : React.createElement(React.Fragment, null,
                React.createElement('div', { className: "bg-gradient-to-r from-orange-50 to-amber-50 rounded-2xl p-6 mb-6" },
                  React.createElement('div', { className: "text-center" },
                    React.createElement('p', { className: "text-gray-600 text-sm mb-2" }, 'BTC Disponibles'),
                    React.createElement('p', { className: "text-5xl font-bold text-gray-800 mb-1" }, formatNumber(supply)),
                    React.createElement('p', { className: "text-gray-500 text-sm" }, 'BTC')
                  )
                ),
                
                React.createElement('div', { className: "space-y-4 mb-6" },
                  React.createElement('div', { className: "flex justify-between items-center" },
                    React.createElement('span', { className: "text-gray-600" }, 'Supply Maximum'),
                    React.createElement('span', { className: "font-semibold text-gray-800" }, formatNumber(maxSupply) + ' BTC')
                  ),
                  React.createElement('div', { className: "flex justify-between items-center" },
                    React.createElement('span', { className: "text-gray-600" }, 'Restant √† miner'),
                    React.createElement('span', { className: "font-semibold text-gray-800" }, formatNumber(maxSupply - supply) + ' BTC')
                  ),
                  React.createElement('div', null,
                    React.createElement('div', { className: "flex justify-between items-center mb-2" },
                      React.createElement('span', { className: "text-gray-600" }, 'Pourcentage min√©'),
                      React.createElement('span', { className: "font-semibold text-gray-800" }, percentageMined + '%')
                    ),
                    React.createElement('div', { className: "w-full bg-gray-200 rounded-full h-3 overflow-hidden" },
                      React.createElement('div', {
                        className: "bg-gradient-to-r from-orange-500 to-amber-500 h-full rounded-full transition-all duration-500",
                        style: { width: percentageMined + '%' }
                      })
                    )
                  )
                ),
                
                React.createElement('div', { className: "flex justify-between items-center text-sm text-gray-500 pt-4 border-t border-gray-200" },
                  React.createElement('span', null, lastUpdate && 'Mis √† jour: ' + lastUpdate.toLocaleTimeString('fr-FR')),
                  React.createElement('button', {
                    onClick: fetchBitcoinSupply,
                    disabled: loading,
                    className: "text-orange-500 hover:text-orange-600 transition-colors disabled:opacity-50"
                  },
                    React.createElement(RefreshCw, { className: 'w-4 h-4' + (loading ? ' animate-spin' : '') })
                  )
                )
              )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(BitcoinSupplyTracker));
  </script>
</body>
</html>
